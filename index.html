<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
        <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
        <title>Lexicon</title>
        <script>
            // get a list of books from the server
            function getBooks(toSelect) {
                $.getJSON('books', function(d) {
                    // clear any existing ones
                    $("#idBooks").empty()
                    d.forEach(e => {
                        $('#idBooks').append('<option>' + e + '</option>')
                    });
                    if (toSelect) {
                        $("#idBooks").val(toSelect)
                    } else {
                        $("#idBooks").val($("#idBooks option:first").val());
                    }
                });
            }

            // set the status of the ok button in the new book dialog
            function checkNewBookName() {
                if (!$("#newBookName").val()) {
                    $("#createNewBookButton").addClass("disabled")
                } else {
                    $("#createNewBookButton").removeClass("disabled")
                }
            }

            function checkRename() {
                if (!$("#renameBookName").val()) {
                    $("#btnRename").addClass("disabled")
                } else {
                    $("#btnRename").removeClass("disabled")
                }
            }

            // create a new book on the server
            function createNewBook() {
                var bookName = $("#newBookName").val()
                $.post('books/newBook', { name: bookName }, function(response) {
                    if (response) {
                        alert(response)
                    } else {
                        getBooks(bookName)
                    }
                })
            }

            function showDeleteBook() {
                $('#deleteBookName').text($("#idBooks").val())
                var confirmDelete = new bootstrap.Modal(document.getElementById('deleteBook'), {
                    keyboard: false
                });
                confirmDelete.show()
            }       
            
            function deleteBook() {
                $.ajax({
                    url: 'books/delete/' + $("#idBooks").val(),
                    type: 'DELETE',
                    success: function() { getBooks() }
                })
            }

            function showRenameBook() {
                $('#renameBookName').val($("#idBooks").val())
                $('#originalName').text($("#idBooks").val())
                var renameBook = new bootstrap.Modal(document.getElementById('renameBook'), {
                    keyboard: false
                });
                renameBook.show()
            }

            function renameBook() {
                $.ajax({
                    url: 'books/rename/' + $("#idBooks").val(),
                    type: 'POST',
                    data: {name: $('#renameBookName').val()},
                    success: function(response) { 
                        if (response) {
                            alert(response)
                        } else {
                            getBooks($('#renameBookName').val()) 
                        }
                    }
                })
            }
        </script>
    </head>
    <body onload="getBooks()">
        <div class="container">
            <h1>Lexicon</h1>
            <h6>by DungeonTiger</h6>
            <div class="mb-3">
                <label for="formbook" class="form-label">Book</label>
                <select id="idBooks" type="text" class="form-control" id="formbook" placeholder="Select a book to work with">
                </select>
                <div style="padding-top:5px">
                    <button class="btn btn-primary btn-sm" type="button" data-bs-toggle="modal" data-bs-target="#newBook">New book</button>
                    <button class="btn btn-secondary btn-sm" type="button" onclick="showRenameBook()">Rename book</button>
                    <button class="btn btn-secondary btn-sm" type="button" onclick="showDeleteBook()">Delete book</button>
                </div>
            </div>
        </div>
        <div class="modal fade" id="newBook">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Add a new book</h5> 
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                    <div class="modal-body">
                        <label for="newBookName" class="form-label">Book name</label>
                        <input onkeyup="checkNewBookName()" type="text" class="form-control" id="newBookName" placeholder="Enter the name of the new book">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="button" onclick="createNewBook()" id="createNewBookButton" class="btn btn-primary disabled" data-bs-dismiss="modal">Create</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="deleteBook">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Delete a book</h5> 
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                    <div class="modal-body">
                        Are you sure that you want to delete the book <b><span id="deleteBookName"></span></b> and all it's contents?
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                        <button type="button" onclick="deleteBook()" class="btn btn-danger" data-bs-dismiss="modal">Yes</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal fade" id="renameBook">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Rename <b><span id="originalName"></span></b></h5> 
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                    <div class="modal-body">
                        <label for="renameBookName" class="form-label">New book name</label>
                        <input onkeyup="checkRename()" type="text" class="form-control" id="renameBookName" placeholder="Enter the new name of this book">
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="button" id="btnRename" onclick="renameBook()" class="btn btn-primary" data-bs-dismiss="modal">Rename</button>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>